<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Wade Command Center v92 - AiGentsy</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link rel="stylesheet" href="/theme.css"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { 
    font-family: 'Inter', sans-serif; 
    margin: 0; 
    background: radial-gradient(circle at center, #0e101a, #000); 
    color: #fff; 
    display: flex; 
  }
  
  .sidebar { 
    width: 280px; 
    background: #0a0a0a; 
    padding: 30px 20px; 
    min-height: 100vh;
    border-right: 1px solid #222;
    overflow-y: auto;
  }
  
  .sidebar img { width: 140px; display: block; margin-bottom: 30px; }
  
  .sidebar-box {
    background: #111;
    border: 1px solid #222;
    border-radius: 8px;
    padding: 14px;
    margin-bottom: 16px;
  }
  
  .sidebar-box h4 {
    color: #00bfff;
    margin: 0 0 10px 0;
    font-size: 0.9rem;
  }
  
  .main { 
    flex: 1;
    padding: 30px; 
    overflow-y: auto;
    max-height: 100vh;
  }
  
  .header-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
  }
  
  .header-row h1 {
    margin: 0;
    font-size: 1.75rem;
    display: flex;
    align-items: center;
    gap: 12px;
  }
  
  .status-badge {
    background: rgba(0, 255, 136, 0.15);
    color: #00ff88;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
  }
  
  .header-actions {
    display: flex;
    gap: 10px;
  }
  
  .btn-glow {
    background: #00bfff;
    color: #000;
    padding: 10px 18px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    font-size: 0.9rem;
    transition: all 0.3s ease;
  }
  
  .btn-glow:hover {
    background: #009cd8;
    transform: translateY(-1px);
  }
  
  .btn-glow:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  
  .btn-glow.danger { background: #ff4444; }
  .btn-glow.success { background: #00ff88; }
  .btn-glow.purple { background: #a78bfa; }
  
  .btn-glow.secondary {
    background: linear-gradient(135deg, #131722 0%, #1a2030 100%);
    color: #00bfff;
    border: 1px solid #00bfff;
  }
  
  .btn-glow.secondary:hover {
    background: linear-gradient(135deg, #00bfff 0%, #009cd8 100%);
    color: #000;
  }
  
  /* Metric Cards Row */
  .metrics-row {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 14px;
    margin-bottom: 24px;
  }
  
  .metric-card {
    background: #111;
    border: 1px solid #222;
    border-radius: 10px;
    padding: 16px;
    box-shadow: 0 0 12px rgba(0,240,255,0.05);
  }
  
  .metric-card .label {
    color: #888;
    font-size: 0.75rem;
    margin-bottom: 6px;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  
  .metric-card .value {
    font-size: 1.5rem;
    font-weight: 700;
    color: #00ff88;
  }
  
  .metric-card .value.blue { color: #00bfff; }
  .metric-card .value.purple { color: #a78bfa; }
  .metric-card .value.yellow { color: #fbbf24; }
  .metric-card .value.orange { color: #f97316; }
  
  .metric-card .sub {
    color: #666;
    font-size: 0.7rem;
    margin-top: 4px;
  }
  
  /* Grid Layout */
  .grid-3 {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 20px;
    margin-bottom: 24px;
  }
  
  .grid-2 {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 20px;
    margin-bottom: 24px;
  }
  
  .grid-2-equal {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 24px;
  }
  
  /* Boxes */
  .metric-box {
    background: #111;
    border: 1px solid #222;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 0 12px rgba(0,240,255,0.05);
  }
  
  .metric-box h3 {
    color: #00bfff;
    margin: 0 0 16px 0;
    font-size: 1rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  
  .metric-box h3 span {
    color: #666;
    font-size: 0.8rem;
    font-weight: 400;
  }
  
  /* Queue Items */
  .queue-item {
    background: #0a0a0a;
    border: 1px solid #222;
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .queue-item:hover { border-color: #333; }
  
  .queue-item-info h4 {
    margin: 0 0 4px 0;
    font-size: 0.9rem;
    color: #fff;
  }
  
  .queue-item-info p {
    margin: 0;
    font-size: 0.75rem;
    color: #888;
  }
  
  .queue-item-actions {
    display: flex;
    gap: 6px;
  }
  
  .queue-item-actions button {
    padding: 5px 10px;
    font-size: 0.75rem;
    border-radius: 4px;
  }
  
  /* Status Grid */
  .status-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 6px;
  }
  
  .status-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 10px;
    background: #0a0a0a;
    border-radius: 6px;
    font-size: 0.8rem;
  }
  
  .status-item .status-live { color: #00ff88; font-weight: 600; }
  .status-item .status-offline { color: #ff4444; font-weight: 600; }
  
  /* Activity Feed */
  .activity-feed {
    max-height: 200px;
    overflow-y: auto;
  }
  
  .activity-item {
    padding: 8px 0;
    border-bottom: 1px solid #1a1a1a;
    display: flex;
    gap: 10px;
    font-size: 0.8rem;
  }
  
  .activity-item:last-child { border-bottom: none; }
  .activity-time { color: #00bfff; font-size: 0.7rem; min-width: 50px; }
  .activity-text { color: #ccc; }
  
  /* Deals Pipeline */
  .deals-pipeline {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    margin-bottom: 14px;
  }
  
  .deal-stage {
    background: #0a0a0a;
    border-radius: 8px;
    padding: 12px;
    text-align: center;
  }
  
  .deal-stage .value { font-size: 1.25rem; font-weight: 700; color: #00bfff; }
  .deal-stage .label { font-size: 0.7rem; color: #888; margin-top: 4px; }
  .deal-stage.pending .value { color: #fbbf24; }
  .deal-stage.progress .value { color: #00bfff; }
  .deal-stage.delivered .value { color: #a78bfa; }
  .deal-stage.completed .value { color: #00ff88; }
  
  /* Spawn Stats */
  .spawn-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
  }
  
  .spawn-stat {
    background: #0a0a0a;
    border-radius: 8px;
    padding: 12px;
    text-align: center;
  }
  
  .spawn-stat .value { font-size: 1.25rem; font-weight: 700; }
  .spawn-stat .label { font-size: 0.7rem; color: #888; margin-top: 4px; }
  
  /* Revenue Channels */
  .revenue-channels {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
  }
  
  .revenue-channel {
    background: #0a0a0a;
    border-radius: 8px;
    padding: 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .revenue-channel .name { font-size: 0.8rem; color: #888; }
  .revenue-channel .amount { font-size: 0.9rem; font-weight: 600; color: #00ff88; }
  
  /* Learning Cards */
  .learning-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
  }
  
  .learning-card {
    background: #0a0a0a;
    border-radius: 8px;
    padding: 12px;
    text-align: center;
  }
  
  .learning-card .stat { font-size: 1.25rem; font-weight: 700; color: #00bfff; }
  .learning-card .label { font-size: 0.7rem; color: #888; margin-top: 4px; }
  
  /* Empty State */
  .empty-state {
    text-align: center;
    padding: 20px;
    color: #666;
  }
  
  .empty-state .icon { font-size: 2rem; margin-bottom: 10px; }
  .empty-state .hint { font-size: 0.75rem; color: #555; }
  
  /* Cycle Results */
  .cycle-results {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 10px;
  }
  
  .cycle-step {
    background: #0a0a0a;
    border-radius: 8px;
    padding: 10px;
    text-align: center;
    font-size: 0.75rem;
  }
  
  .cycle-step .icon { font-size: 1.25rem; margin-bottom: 4px; }
  .cycle-step .name { color: #888; margin-bottom: 4px; }
  .cycle-step .result { color: #00ff88; font-weight: 600; }
  .cycle-step.pending .result { color: #666; }
  .cycle-step.error .result { color: #ff4444; }
  
  /* Scrollbar */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: #111; }
  ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: #444; }
</style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
  <img src="/logo.png" alt="AiGentsy" onerror="this.style.display='none'"/>
  
  <!-- Quick Actions -->
  <div class="sidebar-box">
    <h4>‚ö° Quick Actions</h4>
    <button class="btn-glow" style="width:100%; margin-bottom:8px;" onclick="runFullCycle()" id="btn-full-cycle">
      üöÄ Run Full Cycle
    </button>
    <button class="btn-glow purple" style="width:100%; margin-bottom:8px;" onclick="runSpawnCycle()">
      üè≠ Spawn Businesses
    </button>
    <button class="btn-glow success" style="width:100%;" onclick="requestPayout()">
      üí∏ Request Payout
    </button>
  </div>
  
  <!-- Stripe Balance -->
  <div class="sidebar-box">
    <h4>üí≥ Stripe Balance</h4>
    <div style="font-size:1.5rem; font-weight:700; color:#00ff88;" id="stripe-balance">$0.00</div>
    <div style="font-size:0.75rem; color:#888; margin-top:4px;">Available for payout</div>
  </div>
  
  <!-- Revenue Orchestrator Status -->
  <div class="sidebar-box">
    <h4>üí∞ Revenue Orchestrator</h4>
    <div id="orchestrator-engines" style="font-size:0.8rem;">
      <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
        <span>Spawn Engine</span>
        <span class="status-live" id="engine-spawn">‚óè</span>
      </div>
      <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
        <span>Fiverr</span>
        <span class="status-live" id="engine-fiverr">‚óè</span>
      </div>
      <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
        <span>Cart Recovery</span>
        <span class="status-live" id="engine-cart">‚óè</span>
      </div>
      <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
        <span>Subscriptions</span>
        <span class="status-live" id="engine-subs">‚óè</span>
      </div>
      <div style="display:flex; justify-content:space-between;">
        <span>Arbitrage</span>
        <span class="status-live" id="engine-arb">‚óè</span>
      </div>
    </div>
  </div>
  
  <!-- More Actions -->
  <div class="sidebar-box">
    <h4>üîß More Actions</h4>
    <button class="btn-glow secondary" style="width:100%; margin-bottom:8px;" onclick="refreshDashboard()">
      üîÑ Refresh
    </button>
    <button class="btn-glow secondary" style="width:100%; margin-bottom:8px;" onclick="viewServices()">
      üìã Service Catalog
    </button>
    <button class="btn-glow secondary" style="width:100%;" onclick="viewSpawns()">
      üè≠ View Spawns
    </button>
  </div>
  
  <!-- Last Updated -->
  <div style="font-size:0.7rem; color:#666; text-align:center; margin-top:20px;" id="last-updated">
    Last updated: --
  </div>
</div>

<!-- Main Content -->
<div class="main">
  
  <!-- Header -->
  <div class="header-row">
    <h1>
      üéõÔ∏è Wade Command Center <span style="font-size:0.9rem; color:#00bfff;">v92</span>
      <span class="status-badge" id="system-status-badge">‚óè System Active</span>
    </h1>
  </div>
  
  <!-- Revenue Metrics Row -->
  <div class="metrics-row">
    <div class="metric-card">
      <div class="label">üí≥ Balance</div>
      <div class="value" id="metric-balance">$0.00</div>
      <div class="sub">Stripe available</div>
    </div>
    <div class="metric-card">
      <div class="label">‚è≥ Pending</div>
      <div class="value blue" id="metric-pending">$0.00</div>
      <div class="sub">Processing</div>
    </div>
    <div class="metric-card">
      <div class="label">üè≠ Spawns</div>
      <div class="value purple" id="metric-spawns">0</div>
      <div class="sub">Active businesses</div>
    </div>
    <div class="metric-card">
      <div class="label">üí≥ MRR</div>
      <div class="value" id="metric-mrr">$0.00</div>
      <div class="sub">Subscriptions</div>
    </div>
    <div class="metric-card">
      <div class="label">üõí Recovered</div>
      <div class="value orange" id="metric-carts">0</div>
      <div class="sub">Abandoned carts</div>
    </div>
    <div class="metric-card">
      <div class="label">üìã Queue</div>
      <div class="value yellow" id="metric-pending-approval">0</div>
      <div class="sub">Pending approval</div>
    </div>
  </div>
  
  <!-- Main Grid -->
  <div class="grid-3">
    
    <!-- Spawn Engine -->
    <div class="metric-box">
      <h3>üè≠ Spawn Engine <span id="spawn-status">Active</span></h3>
      <div class="spawn-grid">
        <div class="spawn-stat">
          <div class="value" style="color:#00ff88;" id="spawn-active">0</div>
          <div class="label">Active</div>
        </div>
        <div class="spawn-stat">
          <div class="value" style="color:#fbbf24;" id="spawn-scaling">0</div>
          <div class="label">Scaling</div>
        </div>
        <div class="spawn-stat">
          <div class="value" style="color:#00bfff;" id="spawn-revenue">$0</div>
          <div class="label">Revenue</div>
        </div>
        <div class="spawn-stat">
          <div class="value" style="color:#a78bfa;" id="spawn-referrals">0</div>
          <div class="label">Referrals</div>
        </div>
      </div>
      <div style="margin-top:12px; font-size:0.75rem; color:#888;">
        Autonomous businesses driving signups to AiGentsy
      </div>
    </div>
    
    <!-- Fiverr Orders -->
    <div class="metric-box">
      <h3>üõçÔ∏è Fiverr Orders <span id="fiverr-status">Active</span></h3>
      <div class="spawn-grid" style="grid-template-columns: repeat(3, 1fr);">
        <div class="spawn-stat">
          <div class="value" style="color:#fbbf24;" id="fiverr-pending">0</div>
          <div class="label">Pending</div>
        </div>
        <div class="spawn-stat">
          <div class="value" style="color:#00bfff;" id="fiverr-processing">0</div>
          <div class="label">Processing</div>
        </div>
        <div class="spawn-stat">
          <div class="value" style="color:#00ff88;" id="fiverr-revenue">$0</div>
          <div class="label">Revenue</div>
        </div>
      </div>
      <div style="margin-top:12px; font-size:0.75rem; color:#888;">
        AI fulfills orders automatically
      </div>
    </div>
    
    <!-- Cart Recovery -->
    <div class="metric-box">
      <h3>üõí Cart Recovery <span id="cart-status">Active</span></h3>
      <div class="spawn-grid" style="grid-template-columns: repeat(3, 1fr);">
        <div class="spawn-stat">
          <div class="value" style="color:#fbbf24;" id="cart-abandoned">0</div>
          <div class="label">Abandoned</div>
        </div>
        <div class="spawn-stat">
          <div class="value" style="color:#00bfff;" id="cart-emails">0</div>
          <div class="label">Emails Sent</div>
        </div>
        <div class="spawn-stat">
          <div class="value" style="color:#00ff88;" id="cart-recovered">$0</div>
          <div class="label">Recovered</div>
        </div>
      </div>
      <div style="margin-top:12px; font-size:0.75rem; color:#888;">
        Shopify abandoned cart recovery
      </div>
    </div>
    
  </div>
  
  <!-- Wade Queue & Deals -->
  <div class="grid-2">
    
    <!-- Left Column -->
    <div>
      
      <!-- Wade Approval Queue -->
      <div class="metric-box" style="margin-bottom:20px;">
        <h3>üìã Wade Approval Queue <span id="queue-count">0 items</span></h3>
        <div id="approval-queue" style="max-height:200px; overflow-y:auto;">
          <div class="empty-state">
            <div class="icon">‚ú®</div>
            <p>No pending approvals</p>
            <p class="hint">Click "Run Full Cycle" to discover opportunities</p>
          </div>
        </div>
      </div>
      
      <!-- Client Deals Pipeline -->
      <div class="metric-box">
        <h3>ü§ù Client Deals <span id="deals-total">0 total</span></h3>
        <div class="deals-pipeline">
          <div class="deal-stage pending">
            <div class="value" id="deals-pending">0</div>
            <div class="label">Pending</div>
          </div>
          <div class="deal-stage progress">
            <div class="value" id="deals-in-progress">0</div>
            <div class="label">In Progress</div>
          </div>
          <div class="deal-stage delivered">
            <div class="value" id="deals-delivered">0</div>
            <div class="label">Delivered</div>
          </div>
          <div class="deal-stage completed">
            <div class="value" id="deals-completed">0</div>
            <div class="label">Completed</div>
          </div>
        </div>
        <div style="display:flex; justify-content:space-between; padding-top:10px; border-top:1px solid #222;">
          <span style="color:#888; font-size:0.8rem;">Deal Revenue</span>
          <span style="color:#00ff88; font-weight:700;" id="deals-revenue">$0.00</span>
        </div>
      </div>
      
    </div>
    
    <!-- Right Column -->
    <div>
      
      <!-- System Status -->
      <div class="metric-box" style="margin-bottom:20px;">
        <h3>‚ö° System Status</h3>
        <div class="status-grid" id="system-status">
          <!-- Populated by JS -->
        </div>
      </div>
      
      <!-- Live Activity Feed -->
      <div class="metric-box">
        <h3>üì° Live Activity</h3>
        <div class="activity-feed" id="activity-feed">
          <div class="activity-item">
            <span class="activity-time">0s ago</span>
            <span class="activity-text">Dashboard loaded</span>
          </div>
        </div>
      </div>
      
    </div>
  </div>
  
  <!-- Revenue Channels -->
  <div class="metric-box" style="margin-bottom:20px;">
    <h3>üí∞ Revenue by Channel (24h)</h3>
    <div class="revenue-channels" id="revenue-channels">
      <div class="revenue-channel">
        <span class="name">üè≠ Spawns</span>
        <span class="amount" id="rev-spawns">$0.00</span>
      </div>
      <div class="revenue-channel">
        <span class="name">üõçÔ∏è Fiverr</span>
        <span class="amount" id="rev-fiverr">$0.00</span>
      </div>
      <div class="revenue-channel">
        <span class="name">üõí Cart Recovery</span>
        <span class="amount" id="rev-cart">$0.00</span>
      </div>
      <div class="revenue-channel">
        <span class="name">üí≥ Subscriptions</span>
        <span class="amount" id="rev-subs">$0.00</span>
      </div>
      <div class="revenue-channel">
        <span class="name">üíπ Arbitrage</span>
        <span class="amount" id="rev-arbitrage">$0.00</span>
      </div>
      <div class="revenue-channel">
        <span class="name">üë§ Wade Direct</span>
        <span class="amount" id="rev-wade">$0.00</span>
      </div>
    </div>
  </div>
  
  <!-- Learning Section -->
  <div class="grid-2-equal">
    
    <!-- Yield Memory -->
    <div class="metric-box">
      <h3>üß† Yield Memory</h3>
      <div class="learning-grid">
        <div class="learning-card">
          <div class="stat" id="yield-patterns">0</div>
          <div class="label">Total Patterns</div>
        </div>
        <div class="learning-card">
          <div class="stat" style="color:#00ff88;" id="yield-successful">0</div>
          <div class="label">Successful</div>
        </div>
      </div>
    </div>
    
    <!-- MetaHive -->
    <div class="metric-box">
      <h3>üåê MetaHive</h3>
      <div class="learning-grid">
        <div class="learning-card">
          <div class="stat" id="hive-patterns">0</div>
          <div class="label">Hive Patterns</div>
        </div>
        <div class="learning-card">
          <div class="stat" style="color:#a78bfa;" id="hive-contributors">0</div>
          <div class="label">Contributors</div>
        </div>
      </div>
    </div>
    
  </div>
  
  <!-- Last Orchestrator Cycle -->
  <div class="metric-box">
    <h3>üîÑ Last Full Cycle Results</h3>
    <div id="orchestrator-status">
      <div class="cycle-results" id="cycle-results">
        <div class="cycle-step pending">
          <div class="icon">üîç</div>
          <div class="name">Discovery</div>
          <div class="result">--</div>
        </div>
        <div class="cycle-step pending">
          <div class="icon">üè≠</div>
          <div class="name">Spawn</div>
          <div class="result">--</div>
        </div>
        <div class="cycle-step pending">
          <div class="icon">üì±</div>
          <div class="name">Social</div>
          <div class="result">--</div>
        </div>
        <div class="cycle-step pending">
          <div class="icon">üõçÔ∏è</div>
          <div class="name">Fiverr</div>
          <div class="result">--</div>
        </div>
        <div class="cycle-step pending">
          <div class="icon">üõí</div>
          <div class="name">Cart</div>
          <div class="result">--</div>
        </div>
      </div>
      <div style="color:#888; font-size:0.8rem; margin-top:12px; text-align:center;">
        Click "Run Full Cycle" to monetize the internet
      </div>
    </div>
  </div>
  
</div>

<script>
  const API_BASE = 'https://aigentsy-ame-runtime.onrender.com';
  let activityLog = [];
  let isRunningCycle = false;
  
  // Utility Functions
  function formatCurrency(amount) {
    return '$' + (amount || 0).toFixed(2);
  }
  
  function formatTime(seconds) {
    if (seconds < 60) return seconds + 's ago';
    if (seconds < 3600) return Math.floor(seconds/60) + 'm ago';
    return Math.floor(seconds/3600) + 'h ago';
  }
  
  function addActivity(text, type = 'info') {
    const now = new Date();
    activityLog.unshift({ text, time: now, type });
    if (activityLog.length > 50) activityLog.pop();
    renderActivityFeed();
  }
  
  function renderActivityFeed() {
    const feed = document.getElementById('activity-feed');
    const now = new Date();
    feed.innerHTML = activityLog.slice(0, 12).map(a => `
      <div class="activity-item">
        <span class="activity-time">${formatTime(Math.floor((now - a.time)/1000))}</span>
        <span class="activity-text">${a.text}</span>
      </div>
    `).join('');
  }
  
  async function fetchAPI(endpoint) {
    try {
      const res = await fetch(API_BASE + endpoint);
      return await res.json();
    } catch (e) {
      console.error('API Error:', endpoint, e);
      return { ok: false, error: e.message };
    }
  }
  
  async function postAPI(endpoint, body = {}) {
    try {
      const res = await fetch(API_BASE + endpoint, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });
      return await res.json();
    } catch (e) {
      console.error('API Error:', endpoint, e);
      return { ok: false, error: e.message };
    }
  }
  
  // Load Functions
  async function loadBalance() {
    const data = await fetchAPI('/admin/balance');
    if (data.ok) {
      document.getElementById('stripe-balance').textContent = formatCurrency(data.available || 0);
      document.getElementById('metric-balance').textContent = formatCurrency(data.available || 0);
      document.getElementById('metric-pending').textContent = formatCurrency(data.pending || 0);
    }
  }
  
  async function loadSpawnDashboard() {
    const data = await fetchAPI('/spawn/dashboard');
    if (data.ok) {
      document.getElementById('metric-spawns').textContent = data.active || 0;
      document.getElementById('spawn-active').textContent = data.active || 0;
      document.getElementById('spawn-scaling').textContent = data.scaling || 0;
      document.getElementById('spawn-revenue').textContent = formatCurrency(data.total_revenue || 0);
      document.getElementById('spawn-referrals').textContent = data.ecosystem?.total_referral_signups || 0;
      document.getElementById('rev-spawns').textContent = formatCurrency(data.total_revenue || 0);
    }
  }
  
  async function loadRevenueOrchestrator() {
    // Get orchestrator systems status
    const systems = await fetchAPI('/revenue-orchestrator/systems');
    if (systems.ok && systems.systems) {
      const s = systems.systems;
      document.getElementById('engine-spawn').className = s.spawn_engine ? 'status-live' : 'status-offline';
      document.getElementById('engine-fiverr').className = 'status-live'; // Always show as available
      document.getElementById('engine-cart').className = 'status-live';
      document.getElementById('engine-subs').className = 'status-live';
      document.getElementById('engine-arb').className = 'status-live';
    }
    
    // Get revenue summary
    const revenue = await fetchAPI('/revenue-orchestrator/revenue-summary?hours=24');
    if (revenue.ok) {
      const channels = revenue.by_channel || {};
      document.getElementById('rev-fiverr').textContent = formatCurrency(channels.FIVERR || 0);
      document.getElementById('rev-cart').textContent = formatCurrency(channels.SHOPIFY || 0);
      document.getElementById('rev-subs').textContent = formatCurrency(channels.SUBSCRIPTION || 0);
      document.getElementById('rev-arbitrage').textContent = formatCurrency(channels.ARBITRAGE || 0);
      document.getElementById('rev-wade').textContent = formatCurrency(channels.STRIPE || 0);
    }
    
    // Get MRR
    const mrr = await fetchAPI('/revenue-orchestrator/subscriptions/mrr');
    if (mrr.ok) {
      document.getElementById('metric-mrr').textContent = formatCurrency(mrr.mrr || 0);
    }
  }
  
  async function loadWadeDashboard() {
    const data = await fetchAPI('/wade/dashboard');
    if (data.ok) {
      document.getElementById('metric-pending-approval').textContent = data.pending_approval || 0;
      document.getElementById('queue-count').textContent = `${data.pending_approval || 0} items`;
      
      const queue = data.queue || [];
      const container = document.getElementById('approval-queue');
      
      if (queue.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="icon">‚ú®</div>
            <p>No pending approvals</p>
            <p class="hint">Click "Run Full Cycle" to discover opportunities</p>
          </div>
        `;
      } else {
        container.innerHTML = queue.slice(0, 8).map(w => `
          <div class="queue-item">
            <div class="queue-item-info">
              <h4>${(w.opportunity?.title || w.title || 'Opportunity').substring(0, 30)}...</h4>
              <p>${w.opportunity?.platform || 'Unknown'} ‚Ä¢ ${formatCurrency(w.opportunity?.value || w.estimated_value || 0)}</p>
            </div>
            <div class="queue-item-actions">
              <button class="btn-glow success" onclick="approveWorkflow('${w.id}')">‚úì</button>
              <button class="btn-glow danger" onclick="rejectWorkflow('${w.id}')">‚úó</button>
            </div>
          </div>
        `).join('');
      }
    }
  }
  
  async function loadDeals() {
    const stats = await fetchAPI('/deals/stats');
    if (stats.ok) {
      document.getElementById('deals-total').textContent = `${stats.total_deals || 0} total`;
      document.getElementById('deals-pending').textContent = stats.pending || 0;
      document.getElementById('deals-in-progress').textContent = stats.in_progress || 0;
      document.getElementById('deals-delivered').textContent = stats.delivered || 0;
      document.getElementById('deals-completed').textContent = stats.completed || 0;
      document.getElementById('deals-revenue').textContent = formatCurrency(stats.total_revenue || 0);
    }
  }
  
  async function loadSystemStatus() {
    const data = await fetchAPI('/orchestrator/status');
    const container = document.getElementById('system-status');
    
    if (data.ok && data.systems) {
      container.innerHTML = Object.entries(data.systems).slice(0, 8).map(([name, available]) => `
        <div class="status-item">
          <span>${name.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()).substring(0, 15)}</span>
          <span class="${available ? 'status-live' : 'status-offline'}">
            ${available ? '‚úì' : '‚úó'}
          </span>
        </div>
      `).join('');
    }
  }
  
  async function loadYieldStats() {
    const data = await fetchAPI('/yield/stats/system');
    if (data.ok) {
      document.getElementById('yield-patterns').textContent = data.total_patterns || 0;
      document.getElementById('yield-successful').textContent = data.success_patterns || 0;
    }
  }
  
  async function loadHiveStats() {
    const data = await fetchAPI('/hive/stats');
    if (data.ok) {
      document.getElementById('hive-patterns').textContent = data.total_patterns || 0;
      document.getElementById('hive-contributors').textContent = data.contributors || 0;
    }
  }
  
  // Action Functions
  async function runFullCycle() {
    if (isRunningCycle) return;
    isRunningCycle = true;
    
    const btn = document.getElementById('btn-full-cycle');
    btn.disabled = true;
    btn.textContent = '‚è≥ Running...';
    
    addActivity('üöÄ Starting full cycle (Alpha Discovery + Revenue Orchestrator)...', 'info');
    
    const data = await postAPI('/orchestrator/full-cycle');
    
    if (data.ok) {
      addActivity('‚úÖ Full cycle completed!', 'success');
      
      // Update cycle results display
      const steps = data.steps || {};
      const resultsContainer = document.getElementById('cycle-results');
      
      resultsContainer.innerHTML = `
        <div class="cycle-step ${steps.discovery ? '' : 'error'}">
          <div class="icon">üîç</div>
          <div class="name">Discovery</div>
          <div class="result">${steps.discovery?.opportunities_found || 0} found</div>
        </div>
        <div class="cycle-step ${steps.revenue_orchestrator?.spawn ? '' : 'pending'}">
          <div class="icon">üè≠</div>
          <div class="name">Spawn</div>
          <div class="result">${steps.revenue_orchestrator?.spawn?.spawned || 0} new</div>
        </div>
        <div class="cycle-step ${steps.social ? '' : 'pending'}">
          <div class="icon">üì±</div>
          <div class="name">Social</div>
          <div class="result">${steps.social?.posted || 0} posts</div>
        </div>
        <div class="cycle-step ${steps.revenue_orchestrator?.fiverr ? '' : 'pending'}">
          <div class="icon">üõçÔ∏è</div>
          <div class="name">Fiverr</div>
          <div class="result">${steps.revenue_orchestrator?.fiverr?.processed || 0} orders</div>
        </div>
        <div class="cycle-step ${steps.revenue_orchestrator?.cart_recovery ? '' : 'pending'}">
          <div class="icon">üõí</div>
          <div class="name">Cart</div>
          <div class="result">${steps.revenue_orchestrator?.cart_recovery?.emails_sent || 0} emails</div>
        </div>
      `;
      
      refreshDashboard();
    } else {
      addActivity('‚ùå Full cycle failed: ' + (data.error || 'Unknown'), 'error');
    }
    
    btn.disabled = false;
    btn.textContent = 'üöÄ Run Full Cycle';
    isRunningCycle = false;
  }
  
  async function runSpawnCycle() {
    addActivity('üè≠ Starting spawn cycle...', 'info');
    const data = await postAPI('/spawn/run-cycle');
    if (data.ok) {
      addActivity(`‚úÖ Spawn cycle: ${data.stats?.spawned || 0} new businesses`, 'success');
      loadSpawnDashboard();
    } else {
      addActivity('‚ùå Spawn cycle failed: ' + (data.error || 'Unknown'), 'error');
    }
  }
  
  async function requestPayout() {
    if (!confirm('Transfer available balance to your bank account?')) return;
    addActivity('üí∏ Requesting payout...', 'info');
    const data = await postAPI('/admin/payout');
    if (data.ok) {
      addActivity('‚úÖ Payout initiated: ' + formatCurrency(data.amount), 'success');
      loadBalance();
    } else {
      addActivity('‚ùå Payout failed: ' + (data.error || 'Unknown'), 'error');
    }
  }
  
  async function approveWorkflow(id) {
    addActivity('‚úì Approving workflow...', 'info');
    const data = await postAPI(`/wade/workflow/${id}/approve`);
    if (data.ok) {
      addActivity('‚úÖ Workflow approved!', 'success');
      loadWadeDashboard();
    } else {
      addActivity('‚ùå Approval failed', 'error');
    }
  }
  
  async function rejectWorkflow(id) {
    if (!confirm('Reject this workflow?')) return;
    const data = await postAPI(`/wade/workflow/${id}/reject`);
    if (data.ok) {
      addActivity('‚úó Workflow rejected', 'info');
      loadWadeDashboard();
    }
  }
  
  function viewServices() {
    window.open(API_BASE + '/services/catalog', '_blank');
  }
  
  function viewSpawns() {
    window.open(API_BASE + '/spawn/dashboard', '_blank');
  }
  
  async function refreshDashboard() {
    addActivity('üîÑ Refreshing...', 'info');
    await Promise.all([
      loadBalance(),
      loadSpawnDashboard(),
      loadRevenueOrchestrator(),
      loadWadeDashboard(),
      loadDeals(),
      loadSystemStatus(),
      loadYieldStats(),
      loadHiveStats()
    ]);
    document.getElementById('last-updated').textContent = 'Last updated: ' + new Date().toLocaleTimeString();
    addActivity('‚úÖ Dashboard refreshed', 'success');
  }
  
  // Initialize
  document.addEventListener('DOMContentLoaded', () => {
    refreshDashboard();
    
    // Auto-refresh every 30 seconds
    setInterval(() => {
      refreshDashboard();
    }, 30000);
  });
</script>
</body>
</html>
