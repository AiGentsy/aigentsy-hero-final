<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>AiGentsy — Launch Your AI Business Empire Now</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: radial-gradient(circle at center, #101c2c, #000000);
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      text-align: center;
      overflow: hidden;
    }
    .hero {
      max-width: 900px;
      padding: 40px 20px;
      animation: fadeIn 1.5s ease-out;
      z-index: 2;
    }
    .logo {
      display: block;
      margin: 0 auto 20px;
      max-width: 280px;
      background: transparent;
      filter: none;
    }
    .hero h1 {
      font-size: 2.6rem;
      color: #fff;
      margin-bottom: 20px;
    }
    .hero p {
      font-size: 1.2rem;
      color: #ccc;
      margin-bottom: 30px;
      line-height: 1.6;
    }
    .consent-box {
      background: #0d0d0d;
      border: 1px solid #fff;
      padding: 24px;
      border-radius: 12px;
      max-width: 600px;
      margin: 0 auto;
      box-shadow: 0 0 12px #ffffff33;
    }
    .consent-box input[type="text"],
    .consent-box input[type="password"],
    .consent-box input[type="email"] {
      width: 90%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 6px;
      border: 1px solid #ffffff;
      background: #111;
      color: #fff;
    }
    .consent-box label {
      display: block;
      margin: 10px 0;
      font-size: 0.95rem;
      color: #ccc;
    }
    .toggle-auth {
      margin: 10px 0;
      color: #00bfff;
      cursor: pointer;
      font-size: 0.9rem;
    }
    .consent-box button {
      margin-top: 16px;
      padding: 10px 20px;
      background: #fff;
      color: #000;
      font-weight: bold;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.3s ease;
    }
    .consent-box button:hover:not(:disabled) {
      transform: scale(1.05);
      box-shadow: 0 0 10px #ffffff;
    }
    .consent-box button:disabled {
      background: #444;
      cursor: not-allowed;
    }
    .aigent-options {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-top: 16px;
    }
    .aigent-card {
      background: #111;
      border: 1px solid #fff;
      color: #fff;
      border-radius: 10px;
      padding: 14px 16px;
      width: 250px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.95rem;
    }
    .aigent-card.selected,
    .aigent-card:hover {
      box-shadow: 0 0 10px #ffffff;
      background: #1a1a1a;
    }
    .footer-note {
      margin-top: 50px;
      font-size: 0.9rem;
      color: #666;
    }
    .bg-animation {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      z-index: 1;
      background: radial-gradient(circle at 50% 50%, #ffffff11, transparent 60%);
      animation: bgPulse 6s ease-in-out infinite;
    }
    .auth-error {
      color: #ff6b6b;
      font-size: 0.85rem;
      margin-top: 8px;
      min-height: 20px;
    }
    #signupFields { display: block; }
    @keyframes fadeIn {
      0% { opacity: 0; transform: translateY(20px); }
      100% { opacity: 1; transform: translateY(0); }
    }
    @keyframes bgPulse {
      0%, 100% { transform: scale(1); opacity: 0.5; }
      50% { transform: scale(1.08); opacity: 0.7; }
    }
  </style>
</head>
<body>
  <div class="bg-animation"></div>
  <div class="hero">
    <img src="aigentsy-logo-ultraclean.png" alt="AiGentsy Logo" class="logo" />
    <h1>Launch Your AI Business Empire Now</h1>
    <p>Build a fully-staffed AI company with a C-Suite team that finds clients, closes deals, and scales itself — while you sleep.</p>
    <div class="consent-box">
      <input type="text" id="usernameInput" placeholder="Username" />
      <input type="email" id="emailInput" placeholder="Email (for notifications & invoices)" />
      <input type="password" id="passwordInput" placeholder="Password" />
      <label><input type="checkbox" id="agreeCheckbox"/> I agree to the <a href="/AiGentsy_Terms_of_Use_v2.pdf" style="color:#fff" target="_blank">protocol terms</a>.</label>
      <div class="toggle-auth" id="toggleAuth">Already have an account? Log in</div>
      <div class="auth-error" id="authError"></div>

      <div id="signupFields">
        <div class="aigent-options">
          <div class="aigent-card" data-agent="saas">SaaS AI<br><span style="font-size: 0.85rem;">Build AI-powered software tools</span></div>
          <div class="aigent-card" data-agent="social">Social Media AI<br><span style="font-size: 0.85rem;">Reels, TikToks, content, creator kits</span></div>
          <div class="aigent-card" data-agent="marketing">Marketing AI<br><span style="font-size: 0.85rem;">SEO, ads, outreach — autonomous</span></div>
        </div>

        <div id="aigentsySearchWrapper" style="margin-top: 30px; display:block;">
          <label for="aigentsySearch" style="font-size: 0.95rem; color: #ccc;">Or describe your custom AI business idea:</label><br>
          <input type="text" id="aigentsySearch" placeholder="e.g. podcast production, fitness coaching, real estate agency" style="width: 90%; padding: 10px; margin-top: 10px; border-radius: 6px; border: 1px solid #fff; background: #111; color: #fff;" />
          <div id="aigentsySuggestion" style="margin-top: 10px; font-size: 0.9rem; color: #aaa;"></div>
        </div>
      </div>

      <button id="enterBtn" disabled>Launch Your AI Business Now</button>
    </div>

    <div class="footer-note">
      Autonomous income. Real-world monetization. No gatekeepers.
    </div>
  </div>
  <script>
  (() => {
    if (window.__AIG_HERO_INIT__) return;
    window.__AIG_HERO_INIT__ = true;

    const API_BASE = "https://aigentsy-ame-runtime.onrender.com";

    // Elements
    const usernameInput = document.getElementById('usernameInput');
    const emailInput = document.getElementById('emailInput');
    const passwordInput = document.getElementById('passwordInput');
    const agreeCheckbox = document.getElementById('agreeCheckbox');
    const enterBtn = document.getElementById('enterBtn');
    const searchInput = document.getElementById('aigentsySearch');
    const suggestionBox = document.getElementById('aigentsySuggestion');
    const authError = document.getElementById('authError');
    const signupFields = document.getElementById('signupFields');

    // State
    let authMode = "signup";
    let selectedAgent = null;
    let customBusinessIdea = "";
    let detectedKit = null;

    // Referral
    const params = new URLSearchParams(location.search);
    const referral = params.get("ref") || "origin/hero";
    try { localStorage.setItem("aigentsyReferral", referral); } catch(e){}

    function detectKitFromDescription(text) {
      if (!text) return "saas";
      const t = text.toLowerCase();
      const scores = { saas: 0, marketing: 0, social: 0 };
      const saasWords = ["software", "app", "tool", "api", "saas", "platform", "automation", "dashboard", "integration", "plugin", "bot", "script", "code", "developer", "build", "create", "system", "database", "tech", "ai"];
      saasWords.forEach(w => { if (t.includes(w)) scores.saas += 1; });
      const marketingWords = ["marketing", "seo", "ads", "advertising", "growth", "traffic", "leads", "funnel", "email", "campaign", "ppc", "conversion", "landing page", "customers", "clients", "sales", "revenue", "b2b", "agency", "consulting", "strategy", "business"];
      marketingWords.forEach(w => { if (t.includes(w)) scores.marketing += 1; });
      const socialWords = ["social media", "content", "creator", "influencer", "youtube", "tiktok", "instagram", "reels", "video", "podcast", "followers", "audience", "community", "brand", "personal brand", "course", "teaching", "coaching", "creative", "design", "art", "music"];
      socialWords.forEach(w => { if (t.includes(w)) scores.social += 1; });
      const winner = Object.entries(scores).reduce((a, b) => b[1] > a[1] ? b : a);
      if (winner[1] === 0) return "saas";
      return winner[0];
    }

    function getCompanyType(agent, customInput) {
      if (agent === "saas" || agent === "social" || agent === "marketing") return agent;
      if (customInput && customInput.length > 10) return detectKitFromDescription(customInput);
      return "saas";
    }

    function showSuggestion(value) {
      if (!suggestionBox) return;
      const v = (value || "").toLowerCase();
      let msg = "We'll match you with the best kit for your business.";
      if (!v || v.length < 5) { suggestionBox.textContent = msg; detectedKit = null; return; }
      detectedKit = detectKitFromDescription(v);
      const kitMessages = {
        saas: "SaaS Kit detected — Build tools, automations, and software that sells.",
        marketing: "Marketing Kit detected — Help businesses grow with SEO, ads, and outreach.",
        social: "Social Kit detected — Create content, build audience, monetize attention."
      };
      msg = kitMessages[detectedKit] || kitMessages.saas;
      suggestionBox.textContent = msg;
      const matchingCard = document.querySelector(`.aigent-card[data-agent="${detectedKit}"]`);
      if (matchingCard && !selectedAgent) {
        setTimeout(() => {
          document.querySelectorAll('.aigent-card').forEach(c => c.classList.remove('selected'));
          matchingCard.classList.add('selected');
          selectedAgent = detectedKit;
          updateButtonState();
        }, 300);
      }
      if (value.length > 10) {
        customBusinessIdea = value;
        if (!selectedAgent) { selectedAgent = detectedKit; updateButtonState(); }
      }
    }

    function updateButtonState() {
      if (authMode === "login") {
        enterBtn.disabled = !(usernameInput.value.trim().length > 0 && passwordInput.value.trim().length > 0);
      } else {
        const valid = usernameInput.value.trim().length > 0 && agreeCheckbox.checked && !!selectedAgent;
        enterBtn.disabled = !valid;
      }
    }

    function toggleAuthMode() {
      authMode = (authMode === "login") ? "signup" : "login";
      const el = document.getElementById('toggleAuth');
      if (authMode === "login") {
        el.textContent = "Don't have an account? Sign up";
        signupFields.style.display = "none";
        emailInput.style.display = "none";
        enterBtn.textContent = "Log In";
      } else {
        el.textContent = "Already have an account? Log in";
        signupFields.style.display = "block";
        emailInput.style.display = "block";
        enterBtn.textContent = "Launch Your AI Business Now";
      }
      authError.textContent = "";
      updateButtonState();
    }

    // Events
    document.querySelectorAll('.aigent-card').forEach(card => {
      card.addEventListener('click', () => {
        document.querySelectorAll('.aigent-card').forEach(c => c.classList.remove('selected'));
        card.classList.add('selected');
        selectedAgent = card.getAttribute('data-agent');
        detectedKit = selectedAgent;
        customBusinessIdea = "";
        if (suggestionBox) {
          const kitMessages = {
            saas: "SaaS Kit — Build tools, automations, and software that sells.",
            marketing: "Marketing Kit — Help businesses grow with SEO, ads, and outreach.",
            social: "Social Kit — Create content, build audience, monetize attention."
          };
          suggestionBox.textContent = kitMessages[selectedAgent] || "";
        }
        updateButtonState();
      });
    });

    document.getElementById('toggleAuth').addEventListener('click', toggleAuthMode);
    usernameInput.addEventListener('input', updateButtonState);
    passwordInput.addEventListener('input', updateButtonState);
    agreeCheckbox.addEventListener('change', updateButtonState);
    if (searchInput) searchInput.addEventListener('input', (e) => showSuggestion(e.target.value));

    // --- Auth: Login or Signup ---
    async function doLogin(username, password) {
      const resp = await fetch(`${API_BASE}/auth/login`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, password })
      });
      return await resp.json();
    }

    enterBtn.addEventListener('click', async () => {
      if (enterBtn.disabled) return;
      authError.textContent = "";
      const username = usernameInput.value.trim();
      const password = passwordInput.value.trim() || "default_password";
      const email = emailInput.value.trim();

      if (!username) { authError.textContent = "Enter a username"; return; }

      enterBtn.disabled = true;

      if (authMode === "login") {
        // --- LOGIN MODE ---
        enterBtn.textContent = "Signing in...";
        try {
          const result = await doLogin(username, password);
          if (result.ok) {
            try { localStorage.setItem("aigentsyUsername", username); } catch(e){}
            try { localStorage.setItem("aigentsyToken", result.token); } catch(e){}
            window.location.assign(`/agents/aigent0.html?user=${encodeURIComponent(username)}`);
            return;
          } else {
            authError.textContent = result.error || "Login failed";
          }
        } catch(e) {
          authError.textContent = "Network error — try again";
        }
        enterBtn.disabled = false;
        enterBtn.textContent = "Log In";
        return;
      }

      // --- SIGNUP MODE ---
      if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        authError.textContent = "Enter a valid email address";
        enterBtn.disabled = false;
        return;
      }

      const idea = searchInput ? searchInput.value.trim() : "";
      const finalKit = getCompanyType(selectedAgent, customBusinessIdea || idea);

      try { localStorage.setItem("aigentsyUsername", username); } catch(e){}
      try { localStorage.setItem("aigentsyKit", finalKit); } catch(e){}
      try { localStorage.setItem("aigentsyUserAgent", selectedAgent); } catch(e){}
      try { localStorage.setItem("aigentsyBusinessIdea", customBusinessIdea || idea); } catch(e){}

      enterBtn.textContent = "Building your AI empire...";

      try {
        const response = await fetch(`${API_BASE}/mint`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            username, password, email,
            companyType: finalKit,
            template: selectedAgent,
            customInput: customBusinessIdea || idea,
            referral: referral
          })
        });

        if (response.ok) {
          const result = await response.json();
          if (result.ok) {
            // Auto-login after signup
            const loginResult = await doLogin(username, password);
            if (loginResult.ok) {
              try { localStorage.setItem("aigentsyToken", loginResult.token); } catch(e){}
            }
            window.location.assign(`/agents/aigent0.html?user=${encodeURIComponent(username)}`);
            return;
          } else {
            authError.textContent = result.error || "Signup failed";
          }
        } else {
          authError.textContent = `Server error (${response.status}) — try again`;
        }
      } catch(e) {
        authError.textContent = "Network error — check connection and try again";
      }

      enterBtn.disabled = false;
      enterBtn.textContent = "Launch Your AI Business Now";
    });

    updateButtonState();
  })();
  </script>
</body>
</html>
