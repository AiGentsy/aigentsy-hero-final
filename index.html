<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>AiGentsy ‚Äî The Sovereign Engine of AI Commerce</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: radial-gradient(circle at center, #101c2c, #000000);
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      text-align: center;
      overflow: hidden;
    }
    .hero {
      max-width: 900px;
      padding: 40px 20px;
      animation: fadeIn 1.5s ease-out;
      z-index: 2;
    }
    .logo {
      display: block;
      margin: 0 auto 20px;
      max-width: 280px;
      background: transparent;
      filter: none;
    }
    .hero h1 {
      font-size: 2.6rem;
      color: #fff;
      margin-bottom: 20px;
    }
    .hero p {
      font-size: 1.2rem;
      color: #ccc;
      margin-bottom: 30px;
      line-height: 1.6;
    }
    .consent-box {
      background: #0d0d0d;
      border: 1px solid #fff;
      padding: 24px;
      border-radius: 12px;
      max-width: 600px;
      margin: 0 auto;
      box-shadow: 0 0 12px #ffffff33;
    }
    .consent-box input[type="text"],
    .consent-box input[type="password"] {
      width: 90%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 6px;
      border: 1px solid #ffffff;
      background: #111;
      color: #fff;
    }
    .consent-box label {
      display: block;
      margin: 10px 0;
      font-size: 0.95rem;
      color: #ccc;
    }
    .toggle-auth {
      margin: 10px 0;
      color: #00bfff;
      cursor: pointer;
      font-size: 0.9rem;
    }
    .consent-box button {
      margin-top: 16px;
      padding: 10px 20px;
      background: #fff;
      color: #000;
      font-weight: bold;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.3s ease;
    }
    .consent-box button:hover:not(:disabled) {
      transform: scale(1.05);
      box-shadow: 0 0 10px #ffffff;
    }
    .consent-box button:disabled {
      background: #444;
      cursor: not-allowed;
    }
    .aigent-options {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-top: 16px;
    }
    .aigent-card {
      background: #111;
      border: 1px solid #fff;
      color: #fff;
      border-radius: 10px;
      padding: 14px 16px;
      width: 250px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.95rem;
    }
    .aigent-card.selected,
    .aigent-card:hover {
      box-shadow: 0 0 10px #ffffff;
      background: #1a1a1a;
    }
    .footer-note {
      margin-top: 50px;
      font-size: 0.9rem;
      color: #666;
    }
    .bg-animation {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      z-index: 1;
      background: radial-gradient(circle at 50% 50%, #ffffff11, transparent 60%);
      animation: bgPulse 6s ease-in-out infinite;
    }
    @keyframes fadeIn {
      0% { opacity: 0; transform: translateY(20px); }
      100% { opacity: 1; transform: translateY(0); }
    }
    @keyframes bgPulse {
      0%, 100% { transform: scale(1); opacity: 0.5; }
      50% { transform: scale(1.08); opacity: 0.7; }
    }
  </style>
</head>
<body>
  <div class="bg-animation"></div>
  <div class="hero">
    <img src="aigentsy-logo-ultraclean.png" alt="AiGentsy Logo" class="logo" />
    <h1>The Home of Autonomous Commerce</h1>
    <p>Launch your fully staffed AI business - choose your AiGentsy, auto-match partners, deploy real-world services, and earn autonomously.</p>
    <div class="consent-box">
      <input type="text" id="usernameInput" placeholder="Username" />
      <input type="password" id="passwordInput" placeholder="Password" />
      <label><input type="checkbox" id="agreeCheckbox"/> I agree to the <a href="/AiGentsy_Terms_of_Use_v2.pdf" style="color:#fff" target="_blank">protocol terms</a>.</label>

      <div class="toggle-auth" onclick="toggleAuthMode()">Don't have an account? Sign up</div>

      <div class="aigent-options">
        <div class="aigent-card" data-agent="legal">Legal AiGentsy<br><span style="font-size: 0.85rem;">IP, contracts, licensing, compliance</span></div>
<div class="aigent-card" data-agent="social">Social Media AiGentsy<br><span style="font-size: 0.85rem;">Reels, TikToks, content launch, creator kits</span></div>
<div class="aigent-card" data-agent="saas">SaaS AiGentsy<br><span style="font-size: 0.85rem;">Build AI-powered software tools</span></div>
<div class="aigent-card" data-agent="marketing">Marketing AiGentsy<br><span style="font-size: 0.85rem;">SEO, ads, outreach ‚Äî fully autonomous</span></div>
      </div>

      <div id="aigentsySearchWrapper" style="margin-top: 30px;">
        <label for="aigentsySearch" style="font-size: 0.95rem; color: #ccc;">Tell us what type of AiGentsy to build you</label><br>
        <input type="text" id="aigentsySearch" placeholder="e.g. podcast business, saas app, coaching brand" style="width: 90%; padding: 10px; margin-top: 10px; border-radius: 6px; border: 1px solid #fff; background: #111; color: #fff;" />
        <div id="aigentsySuggestion" style="margin-top: 10px; font-size: 0.9rem; color: #aaa;"></div>
      </div>

      <button id="enterBtn" disabled>üöÄ Launch Your AiGentsy</button>
    </div>

    <div class="footer-note">
      Autonomous income. Real-world monetization. No gatekeepers.
    </div>
  </div>

  <script>
  let authMode = "login";
  const usernameInput = document.getElementById('usernameInput');
  const passwordInput = document.getElementById('passwordInput');
  const agreeCheckbox = document.getElementById('agreeCheckbox');
  const enterBtn = document.getElementById('enterBtn');
  const aigentCards = document.querySelectorAll('.aigent-card');
  const toggleAuthText = document.querySelector('.toggle-auth');
  const aigentsySearch = document.getElementById("aigentsySearch");
  let selectedAgent = null;

  const urlParams = new URLSearchParams(window.location.search);
  const refCode = urlParams.get("ref");
  if (refCode) localStorage.setItem("aigentsyReferral", refCode);

  aigentCards.forEach(card => {
    card.addEventListener('click', () => {
      aigentCards.forEach(c => c.classList.remove('selected'));
      card.classList.add('selected');
      selectedAgent = card.getAttribute('data-agent');
      updateButtonState();
    });
  });

  function updateButtonState() {
    const valid = usernameInput.value.trim() && passwordInput.value.length >= 4 && agreeCheckbox.checked && selectedAgent;
    enterBtn.disabled = !valid;
  }

  function toggleAuthMode() {
    authMode = authMode === "login" ? "signup" : "login";
    toggleAuthText.textContent = authMode === "login" ? "Don't have an account? Sign up" : "Already have an account? Log in";
    updateButtonState();
  }

  usernameInput.addEventListener('input', updateButtonState);
  passwordInput.addEventListener('input', updateButtonState);
  agreeCheckbox.addEventListener('change', updateButtonState);

  // üí° Search suggestion logic
  document.addEventListener('DOMContentLoaded', () => {
    const searchWrapper = document.getElementById("aigentsySearchWrapper");
    const suggestionBox = document.getElementById("aigentsySuggestion");

    function showSuggestions(value) {
      const lower = value.toLowerCase();
      let match = "";
      if (lower.includes("legal")) match = "Try the Legal AiGentsy ‚Äì built for IP, licensing, and contracts.";
      else if (lower.includes("podcast")) match = "Try the Podcast AiGentsy ‚Äì auto-produce and distribute audio.";
      else if (lower.includes("saas")) match = "Try the SaaS AiGentsy ‚Äì build agent-powered web tools.";
      else if (lower.includes("marketing") || lower.includes("ads")) match = "Try the Marketing AiGentsy ‚Äì launch SEO, ads, and growth campaigns.";
      else if (lower.includes("agency")) match = "Sounds like a business service AiGentsy ‚Äî we can assemble one for you.";
      else match = "We‚Äôll build you a custom AiGentsy based on your input.";
      suggestionBox.innerText = match;
    }

    aigentsySearch.addEventListener("input", (e) => {
      showSuggestions(e.target.value);
    });

    function maybeShowSearch() {
      const valid = usernameInput.value.trim() && passwordInput.value.length >= 4 && agreeCheckbox.checked && selectedAgent;
      searchWrapper.style.display = valid ? "block" : "none";
    }

    usernameInput.addEventListener('input', maybeShowSearch);
    passwordInput.addEventListener('input', maybeShowSearch);
    agreeCheckbox.addEventListener('change', maybeShowSearch);
    aigentCards.forEach(card => card.addEventListener('click', maybeShowSearch));
  });
    
  // ... your existing login/signup logic above ...

  async function registerUserToJSONBin(username, selectedAgent, customDescription, referralCode) {
    const now = new Date().toISOString();
    const roleMap = {
  "legal": "CLO",
  "social": "CSO",
  "saas": "CTO",
  "marketing": "CMO",
  "universal": "COO"
    };

   const entry = {
  id: `User #${Date.now()}`,
  consent: {
    agreed: true,
    username,
    timestamp: now
  },
  trait: selectedAgent || "founder",
  traits: [selectedAgent, "founder", "autonomous", "aigentsy"],
  prebuiltKit: ["legal", "social", "saas", "marketing"].includes(selectedAgent) ? selectedAgent : "universal",
  offeringType: "kit",
  offeringKeywords: selectedAgent === "social" ? ["tiktok", "instagram", "reels", "launch", "content"]
    : selectedAgent === "saas" ? ["software", "tool", "platform", "tech"]
    : selectedAgent === "legal" ? ["contracts", "ip", "nda", "compliance"]
    : selectedAgent === "marketing" ? ["seo", "ads", "growth", "funnels"]
    : ["custom", "idea", "autonomous", "builder"],
  referral: referralCode || "origin/hero",
  runtimeURL: "https://aigentsy.com/agents/aigent0.html",
  mintTime: now,
  role: roleMap[selectedAgent] || "CEO",
  protocol: "MetaUpgrade25",
  realm: {
    name: "Realm 101 ‚Äî Strategic Expansion",
    joinedAt: now
  },
  metaVenture: {
    ventureHive: "Autonomous Launch",
    ventureRole: roleMap[selectedAgent] || "CEO",
    ventureStatus: "Pending",
    ventureID: `MV-${Date.now()}`
  },
  remix: {
    remixCount: 0,
    remixCredits: 1000,
    lineageDepth: 0,
    royaltyTerms: "Standard 30%"
  },
  mirror: {
    mirroredInRealms: ["Realm 101 ‚Äî Strategic Expansion"],
    mirrorIntegrity: "Pending",
    sentinelAlert: false
  },
  yield: {
    autoStake: false,
    aigxEarned: 0,
    vaultYield: 0,
    remixYield: 0
  },
  earningsEnabled: true,
  listingStatus: "Active",
  protocolStatus: "Bound",
  tethered: true,
  name: `AiGent ${roleMap[selectedAgent] || "Founder"}`,
  sdkAccess_eligible: selectedAgent === "saas",
  sdkAccess: false,
  vaultAccess: true,  // ‚úÖ Force unlock on mint
  remixUnlocked: false,
  cloneLicenseUnlocked: false,
  licensingApproved: false,
  stripeUnlocked: false,
  productsPurchased: [],
  teachStage: 1,
  teachInComplete: false,
  complianceReviewed: false,
  complianceLog: [],
  teachInLog: [],
  runtimeFlags: {
    flagged: false,
    eligibleForAudit: true,
    needsReview: false,
    vaultAccess: true  // ‚úÖ Ensure charts/unlocks render
  }
};
    
    try {
      const getRes = await fetch(JSONBIN_URL, {
        headers: {
          "X-Master-Key": JSONBIN_SECRET
        }
      });

      if (!getRes.ok) {
        console.error("JSONBin GET failed:", await getRes.text());
        return;
      }

      const currentData = await getRes.json();
      const updatedArray = [...currentData.record, entry];

      const putRes = await fetch(JSONBIN_URL, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          "X-Master-Key": JSONBIN_SECRET
        },
        body: JSON.stringify(updatedArray)
      });

      if (!putRes.ok) {
        console.error("JSONBin PUT failed:", await putRes.text());
      } else {
        console.log("‚úÖ New user saved to JSONBin:", username);
      }
    } catch (err) {
      console.error("JSONBin error:", err);
    }
  }
   
   enterBtn.addEventListener('click', async () => {
  const user = usernameInput.value.trim();
  const pass = passwordInput.value;

  const storedUser = localStorage.getItem(`user:${user}`);
  const storedPass = localStorage.getItem(`pass:${user}`);

  const isNewUser = !storedUser || storedPass !== pass;

  if (isNewUser) {
    if (authMode === "signup") {
      localStorage.setItem(`user:${user}`, user);
      localStorage.setItem(`pass:${user}`, pass);

      try {
        await registerUserToJSONBin(
          user,
          selectedAgent,
          aigentsySearch.value,
          localStorage.getItem("aigentsyReferral")
        );
      } catch (err) {
        alert("‚ùå Registration failed. Please try again.");
        return; // Stop execution
      }
    } else {
      alert("‚ùå Incorrect login. Switch to Sign Up if you're new.");
      return; // Stop execution
    }
  } else {
    authMode = "login";
  }

  localStorage.setItem("aigentsyUsername", user);
  localStorage.setItem("aigentsyUserConsent", "true");
  localStorage.setItem("aigentsyUserAgent", selectedAgent);
  localStorage.setItem("aigentsyAuthMode", authMode);

  // ‚úÖ Safer redirect
  window.location.assign(`/agents/aigent0.html?user=${user}`);
});
// üß† Launch Kit Modal Automatically on Hero Selection
aigentCards.forEach(card => {
  card.addEventListener('click', () => {
    const type = card.getAttribute('data-agent');
    if (["legal", "saas", "marketing", "social"].includes(type)) {
  openKitModal(type);
}
  });
});

// üß† Also open custom modal if user types a new idea
aigentsySearch.addEventListener("input", (e) => {
  const value = e.target.value.toLowerCase();
  if (value.length > 8 && !["legal", "saas", "marketing", "social"].some(v => value.includes(v))) {
    openKitModal("custom");
  }
});

</script>
<script>
(() => {
  // -----------------------------
  // Config
  // -----------------------------
  const BASE = ""; // set to e.g. "https://your-api.onrender.com" if API is on a different host
  const API = {
    mint:         `${BASE}/mint`,
    offerPublish: `${BASE}/offer/publish`,
    kpiRollup:    `${BASE}/kpi/rollup`
  };

  // -----------------------------
  // Elements
  // -----------------------------
  const usernameInput  = document.getElementById('usernameInput');
  const passwordInput  = document.getElementById('passwordInput'); // UI only; not sent to server
  const agreeCheckbox  = document.getElementById('agreeCheckbox');
  const enterBtn       = document.getElementById('enterBtn');
  const aigentCards    = document.querySelectorAll('.aigent-card');
  const searchInput    = document.getElementById('aigentsySearch');
  const suggestionBox  = document.getElementById('aigentsySuggestion');

  // -----------------------------
  // State
  // -----------------------------
  let authMode = "login";             // we still show login/signup UX, but /mint is idempotent
  let selectedAgent = null;           // legal | social | saas | marketing | custom
  // capture ?ref and basic UTMs into one referral string
  const params = new URLSearchParams(location.search);
  const referral = params.get("ref") ||
                   [params.get("utm_source"), params.get("utm_medium"), params.get("utm_campaign")]
                     .filter(Boolean).join("/") || "origin/hero";
  localStorage.setItem("aigentsyReferral", referral);

  // -----------------------------
  // Helpers
  // -----------------------------
  const companyTypeMap = (agent) => {
    switch ((agent || "").toLowerCase()) {
      case "legal":     return "legal";
      case "social":    return "social";
      case "saas":      return "saas";
      case "marketing": return "marketing";
      case "custom":    return "custom";
      default:          return "general";
    }
  };

  function updateButtonState() {
    const valid =
      usernameInput.value.trim().length > 0 &&
      agreeCheckbox.checked &&
      !!selectedAgent;
    // (password length check removed from gating server call; keep if you want stricter UI)
    enterBtn.disabled = !valid;
  }

  function showSuggestion(value) {
    const v = (value || "").toLowerCase();
    let msg = "We‚Äôll build you a custom AiGentsy based on your input.";
    if (v.includes("legal"))        msg = "Try the Legal AiGentsy ‚Äî IP, licensing, contracts.";
    else if (v.includes("podcast")) msg = "Try a Podcast AiGentsy ‚Äî auto-produce & distribute.";
    else if (v.includes("saas"))    msg = "Try the SaaS AiGentsy ‚Äî agent-powered web tools.";
    else if (v.includes("ads") || v.includes("marketing")) msg = "Try the Marketing AiGentsy ‚Äî SEO, ads, outreach.";
    else if (v.includes("agency"))  msg = "Sounds like a services AiGentsy ‚Äî we can assemble one.";
    suggestionBox.textContent = msg;
  }

  // No-op stub to avoid errors from old code references
  window.openKitModal = function(){};

  // -----------------------------
  // Event wiring
  // -----------------------------
  aigentCards.forEach(card => {
    card.addEventListener('click', () => {
      aigentCards.forEach(c => c.classList.remove('selected'));
      card.classList.add('selected');
      selectedAgent = card.getAttribute('data-agent');
      updateButtonState();
      // seed search suggestions by selected agent
      showSuggestion(selectedAgent);
    });
  });

  usernameInput.addEventListener('input', updateButtonState);
  agreeCheckbox.addEventListener('change', updateButtonState);
  passwordInput.addEventListener('input', updateButtonState);

  document.addEventListener('DOMContentLoaded', () => {
    // turn search on when the form is valid
    function maybeShowSearch() {
      const valid = !enterBtn.disabled;
      document.getElementById("aigentsySearchWrapper").style.display = valid ? "block" : "none";
    }
    usernameInput.addEventListener('input', maybeShowSearch);
    agreeCheckbox.addEventListener('change', maybeShowSearch);
    aigentCards.forEach(card => card.addEventListener('click', maybeShowSearch));

    searchInput.addEventListener('input', (e) => showSuggestion(e.target.value));
  });

  // Toggle login/signup label
  window.toggleAuthMode = function () {
    authMode = (authMode === "login") ? "signup" : "login";
    document.querySelector('.toggle-auth').textContent =
      (authMode === "login") ? "Don't have an account? Sign up" : "Already have an account? Log in";
    updateButtonState();
  };

  // -----------------------------
  // Main action: Mint ‚Üí (optional offer publish) ‚Üí redirect
  // -----------------------------
  enterBtn.addEventListener('click', async () => {
    if (enterBtn.disabled) return;

    const username    = usernameInput.value.trim();
    const companyType = companyTypeMap(selectedAgent);
    const idea        = searchInput.value.trim();

    // Persist local session hints (no passwords)
    localStorage.setItem("aigentsyUsername", username);
    localStorage.setItem("aigentsyUserConsent", agreeCheckbox.checked ? "true" : "false");
    localStorage.setItem("aigentsyUserAgent", selectedAgent);
    localStorage.setItem("aigentsyAuthMode", authMode);

    // 1) Mint (idempotent: creates if new, returns existing if already minted)
    try {
      const res = await fetch(API.mint, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ username, companyType, referral })
      });
      const j = await res.json();
      if (!j.ok) throw new Error(j.error || "Mint failed");
    } catch (e) {
      alert("‚ùå Could not mint your AiGentsy. Please try again.");
      console.error(e);
      return;
    }

    // 2) Optionally publish a starter offer for a ‚Äúlive‚Äù first impression
    try {
      await fetch(API.offerPublish, {
        method:"POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({
          username,
          title: idea ? `Quick Win: ${idea.slice(0, 40)}` : "Quick Win Offer",
          price: companyType === "saas" ? 199 : 149,
          scope: companyType === "saas" ? "Prototype a micro-SaaS module (48h)" : "Starter branding/launch asset (24h)",
          terms: "Standard terms",
          src: "hero"
        })
      });
      // small KPI snapshot so tiles are populated
      fetch(API.kpiRollup, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ username })
      }).catch(()=>{});
    } catch (e) {
      // non-fatal
      console.warn("offerPublish/kpiRollup skipped:", e);
    }

    // 3) Redirect to dashboard
    window.location.assign(`/agents/aigent0.html?user=${encodeURIComponent(username)}`);
  });
})();
</script>
<script>
  // Point to your API
  const BASE = "https://aigentsy-ame-runtime.onrender.com";

  async function mintFromHero({ username, companyType, referral, customInput, meta_role }) {
    const body = { username, companyType, referral, customInput, meta_role };
    const res = await fetch(BASE + "/mint", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body)
    });
    const json = await res.json().catch(() => ({}));
    if (!res.ok) throw new Error(json.detail || "mint failed");
    return json.record || json; // server returns { ok, record }
  }

  // Hook up the Launch button
  (function wireMint() {
    const enterBtn = document.getElementById("enterBtn");
    const usernameInput = document.getElementById("usernameInput");
    const searchInput = document.getElementById("aigentsySearch");
    // assuming you already set window.selectedAgent when the user picks a card:
    let selectedAgent = window.selectedAgent || "general";

    // if your code uses a different variable, update this assignment:
    document.querySelectorAll(".aigent-card").forEach(card => {
      card.addEventListener("click", () => {
        selectedAgent = card.getAttribute("data-agent") || "general";
      });
    });

    enterBtn.addEventListener("click", async () => {
      const username = (usernameInput.value || "").trim();
      const companyType = (selectedAgent || "general").toLowerCase();
      const referral = localStorage.getItem("aigentsyReferral") || "origin/hero";
      const customInput = (searchInput && searchInput.value) || "";

      if (!username) { alert("Enter a username"); return; }

      enterBtn.disabled = true; enterBtn.textContent = "Minting‚Ä¶";
      try {
        const rec = await mintFromHero({ username, companyType, referral, customInput });
        // minimal local session
        localStorage.setItem("aigentsyUsername", rec.username || username);
        localStorage.setItem("aigentsyUserAgent", companyType);
        localStorage.setItem("aigentsyUserConsent", "true");
        // go to dashboard
        window.location.assign(`/agents/aigent0.html?user=${encodeURIComponent(username)}`);
      } catch (e) {
        console.error(e);
        alert("‚ùå Mint error: " + e.message);
      } finally {
        enterBtn.disabled = false; enterBtn.textContent = "üöÄ Launch Your AiGentsy";
      }
    });
  })();
</script>

</body>
</html>
